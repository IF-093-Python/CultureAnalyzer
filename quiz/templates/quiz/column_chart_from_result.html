{% extends 'base.html' %}
{% load filters %}
{% load zip %}
{% block title %}Your result{% endblock %}
{% block content %}
<div class="d-flex justiy-content-between flex-wrap">
    <div class="form-group col-md-4">
    <form method="post" class="mb-1">
        {% csrf_token %}
        <input type="submit" class="btn btn-blue" value="Result">
        <select name='select_indicator' class="selectpicker"
                multiple="multiple" data-live-search="true" data-max-options="5">
            {% for i in country_indicators%}
            <option value="{{i.get_indicators}}"
                    {% if i.iso_code is countries_values.keys %}
                    selected="selected"
                    {% endif %}>
                {{i.name}}
            </option>
            {% endfor %}
        </select>
    </form>
        <!--Table with indicators -->
        <table class="table table-hover">
            <thead class="thead-light">
            <tr>
                <th scope="col" class="text-center w-50">Indicator</th>
                <th scope="col" class="text-center w-50">Value</th>
            </tr>
            </thead>
            <tbody>
            {% for val, indicator in result|zip:indicator_name %}
            <tr>
                <td class="text-center">{{indicator}}</td>
                <td class="text-center">{{val}}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        <!--End table-->
    </div>


        <div class="form-group col-md-8">
            <div class="d-none">
                {% include "quiz/explanation_indicators.html" %}
            </div>
            <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab"
                       aria-controls="home"
                       aria-selected="true">Chart</a>
                </li>
                {% if countries_names %}
                    {% for country_name in countries_names %}
                        <li class="nav-item">
                            <a class="nav-link" id="{{ country_name }}-tab" data-toggle="tab" href="#{{ country_name }}"
                               role="tab"
                               aria-controls="{{ country_name }}"
                               aria-selected="false">
                                {{ country_name|truncatechars:12 }}
                            </a>
                        </li>
                    {% endfor %}
                {% endif %}
            </ul>
            <div class="tab-content" id="myTabContent">
                <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                    <div id="container"
                         style="min-width: 310px; height: 400px; margin: 0 auto;"></div>
                </div>
                {% if countries_values %}
                    {% for country_name in countries_names %}
                        <div class="tab-pane fade" id="{{ country_name }}" role="tabpanel"
                             aria-labelledby="{{ country_name }}-tab"
                             style="background-color: #fff;">
                            <!--Creating views of feedbacks and recommendations-->
                            <div class="container">
                                {% with feedbacks_by_ind=countries_feedbacks|lookup:country_name %}
                                    {% for indicator, feedbacks in feedbacks_by_ind.items %}
                                        {% if feedbacks %}
                                            <h5>Feedbacks for {{ indicator }}:</h5>
                                            {% for feedback_obj in feedbacks %}
                                                - {{ feedback_obj.feedback }}<br>

                                                {% with recommendations=feedback_obj.recommendation_set.all %}
                                                    {% if recommendations %}
                                                        <br>Recommendations:
                                                    {% endif %}

                                                    <ul>
                                                    {% for r in recommendations %}
                                                       <li> {{ r.recommendation }}</li>
                                                    {% endfor %}
                                                    </ul>

                                                {% endwith %}

                                            {% endfor %}
                                        {% endif %}
                                    {% endfor %}
                                {% endwith %}
                            </div>
                            <!--End of feedbacks, recommendations-->
                        </div>
                    {% endfor %}
                {% endif %}

            </div>
        </div>

        <script>


            Highcharts.chart('container', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'Culture Analyzer diagram'
                },
                xAxis: {
                    categories: [
                        'PDI',
                        'IDV',
                        'MAS',
                        'UAI',
                        'LTO',
                        'IVR'
                    ],
                    crosshair: true
                },
                yAxis: {
                    min: 0,
                    title: {
                        text: 'Value'
                    }
                },
                tooltip: {
                    headerFormat: '<span style="font-size:10px">{point.key}</span>' +
                        '<table>',
                    pointFormat: '<tr><td style="color:{series.color};padding:0">' +
                        '{series.name}: </td>' +
                        '<td style="padding:0"><b>{point.y:.1f} mm</b></td></tr>',
                    footerFormat: '</table>',
                    shared: true,
                    useHTML: true
                },
                plotOptions: {
                    column: {
                        pointPadding: 0.1,
                        borderWidth: 0
                    }
                },
                series: [{
                    name: '{{name}}',
                    data: {{result}},
                },{%for k, ind in countries_values.items %}
                    {
                        name: '{{k}}',
                        data: {{ind}}
                    },
                {% endfor %} ]
            });

        </script>
</div>
{% endblock %}
